{% extends "layouts/base-fullscreen.html" %}
{#{% extends "layouts/base.html" %}#}
{% load static %}
{% block title %} Company Users {% endblock %}

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}
{% endblock stylesheets %}

{% block content %}
    {%  if companyusers %}
    <div class="row">
        <div class="col-12 mb-4">
            <div class="card border-0 shadow components-section">
                <div class="card-header">
                    <div class="d-flex">
                        <div class="me-auto">
                            <h1 class="h6">{{ companyname }} Users</h1>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div id="form" style="display:none">
                        <form method="post" action="" enctype="multipart/form-data" novalidate>
                            {% csrf_token %}
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group mb-4">
                                        <label for="username">User Name</label>
                                        <div class="input-group">
                                            {{ form.username }}
                                        </div>
                                        <span class="text-error">{{ form.username.errors }}</span>
                                    </div>
                                    <div class="form-group mb-4">
                                        <label for="email">E-Mail</label>
                                        <div class="input-group">
                                            {{ form.email }}
                                        </div>
                                        <span class="text-error">{{ form.email.errors }}</span>
                                    </div>
                                    <div class="form-group mb-4">
                                        <label for="first_name">First Name</label>
                                        <div class="input-group">
                                            {{ form.first_name }}
                                        </div>
                                        <span class="text-error">{{ form.first_name.errors }}</span>
                                    </div>
                                    <div class="form-group mb-4">
                                        <label for="last_name">Last Name</label>
                                        <div class="input-group">
                                            {{ form.last_name }}
                                        </div>
                                        <span class="text-error">{{ form.last_name.errors }}</span>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-4">
                                            <div class="form-group mb-4">
                                                <label for="is_superuser">Is Super User</label>
                                                <div class="input-group">
                                                    {{ form.is_superuser }}
                                                </div>
                                                <span class="text-error">{{ form.is_superuser.errors }}</span>
                                            </div>
                                        </div>
                                        <div class="col-sm-4">
                                            <div class="form-group mb-4">
                                                <label for="is_active">Is Active</label>
                                                <div class="input-group">
                                                    {{ form.is_active }}
                                                </div>
                                                <span class="text-error">{{ form.is_active.errors }}</span>
                                            </div>
                                        </div>
                                        <div class="col-sm-4">
                                            <div class="form-group mb-4">
                                                <label for="group">Role</label>
                                                <div class="input-group">
                                                    {{ form.group }}
                                                </div>
                                                <span class="text-error">{{ form.group.errors }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group mb-4" style="overflow-y: scroll; height:400px;">
                                        <label for="companies">Companies</label>
                                        <div class="input-group">
                                            {{ form.companies }}
                                        </div>
                                        <span class="text-error">{{ form.companies.errors }}</span>
                                    </div>
                                </div>
                            </div>
                            <div style="width:100%">
                            </div>
                        </form>
                    </div>
                    <table id="example" class="table table-striped table-valign-middle" style="width:100%">
                        <thead class="tmt_thead">
                        <tr>
                            <th class="tmt_th">User Name</th>
                            <th class="tmt_th">Name</th>
                            <th class="tmt_th">E-Mail</th>
                        </tr>
                        </thead>
                        {% for user in companyusers %}
                            <tr>
                                <td>{{user.username}}</td>
                                <td>{{user.first_name }} {{user.last_name }}</td>
                                <td>{{user.email}}</td>
                            </tr>
                        {% endfor %}
                    </table>
                    <div>
                        <div id="divBackground" style="position: fixed; z-index: 999; height: 100%; width: 100%; top: 0; left:0; background-color: Black; filter: alpha(opacity=60); opacity: 0.6; -moz-opacity: 0.8;display:none">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% else %}
        <div class="alert alert-info" role="alert">
          {{ mesaj }}
        </div>
    {% endif %}


    {% block scripts %}
        {#        {{ block.super }}#}
        <script>
            jQuery(function($) {
                {#$(window).bind("beforeunload", function() {#}
                {##}
                {#    window.opener.location.reload();#}
                {#return true;#}
                {##}
                {#);#}
                {#$("#genapikey").click(function (e) {#}
                {#    e.preventDefault();#}
                {#    var apikey = createUUID();#}
                {#    $("#id_apikey").val(apikey);#}
                {#);#}
                {#$('#id_logo').on('change', function () {#}
                {#    $("#imglogo").attr("src", '/' + this.value);#}
                {#);#}
                {#$("#divBackground").on('hide', function () {#}
                {#    window.opener.location.reload();#}
                {#);#}
                {#var licensetypeTags =#}
                {#{{ licensetypeTags|safe }}#}
                {#var companysizeTags =#}
                {#{{ companysizeTags|safe }}#}
                {#var countryTags = {{ countries|safe }};#}
                {#var activityareaTags =#}
                {#{{ activityareaTags|safe }}#}
                {#var securitygradeTags = {{ securitygradeTags|safe }}#}
                {#    $("#id_country").autocomplete({#}
                {#        source: countryTags,#}
                {#        minLength: 0#}
                {#    }).bind('focus', function () {#}
                {#        $(this).autocomplete("search");#}
                {#    });#}
                {#$("#id_licensetype").autocomplete({#}
                {#    source: licensetypeTags,#}
                {#    scroll: true,#}
                {#    minLength: 0#}
                {#).bind('focus', function () {#}
                {#    $(this).autocomplete("search");#}
                {#);#}
                {#$("#id_companysize").autocomplete({#}
                {#    source: companysizeTags,#}
                {#    minLength: 0#}
                {#).bind('focus', function () {#}
                {#    $(this).autocomplete("search");#}
                {#);#}
                {#$("#id_activityarea").autocomplete({#}
                {#    source: activityareaTags,#}
                {#    minLength: 0#}
                {#).bind('focus', function () {#}
                {#    $(this).autocomplete("search");#}
                {#);#}
                {#$("#id_securitygrade").autocomplete({#}
                {#    source: securitygradeTags,#}
                {#    minLength: 0#}
                {#).bind('focus', function () {#}
                {#    $(this).autocomplete("search");#}
                {#);#}

                {#$(window).on("beforeunload", function() {#}
                {#    return confirm("Do you really want to close?");#}
                {#)#}
                {#$(window).unload(function() {#}
                {#    window.opener.location.reload();#}
                {#;#}
                {#$( "#tags" ).autocomplete({#}
                {#    source: availableTags,#}
                {#    minLength:0#}
                {#).bind('focus', function(){ $(this).autocomplete("search"); } );#}
            });
            {#function createUUID() {#}
            {#    var s = [];#}
            {#    var hexDigits = "0123456789abcdef";#}
            {#    for (var i = 0; i < 36; i++) {#}
            {#        s[i] = hexDigits.substr(Math.floor(Math.random() * 0x10), 1);#}
            {#    }#}
            {#    s[14] = "4";  // bits 12-15 of the time_hi_and_version field to 0010#}
            {#    s[19] = hexDigits.substr((s[19] & 0x3) | 0x8, 1);  // bits 6-7 of the clock_seq_hi_and_reserved to 01#}
            {#    s[8] = s[13] = s[18] = s[23] = "-";#}
            {##}
            {#    var uuid = s.join("");#}
            {#    return uuid;#}
            {##}
            function PopupCenter(pageURL, title,w,h) {
                var left = (screen.width/2)-(w/2);
                var top = (screen.height/2)-(h/2);
                var targetWin = window.open (pageURL, title, 'toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width='+w+', height='+h+', top='+top+', left='+left);
                return targetWin;
            }
            function HideModalDiv()
            {
                var bcgDiv = document.getElementById("divBackground");
                bcgDiv.style.display="none";
            }
            function OnClose()
            {
                if(window.opener != null && !window.opener.closed)
                {
                    {#window.opener.location.reload();#}
                    window.opener.HideModalDiv();
                }
            }
            function refreshParent() {
                window.opener.location.reload();
            }
            window.onunload = refreshParent;
        </script>
    {% endblock %}
{% endblock content %}

{% block javascripts %}
{% endblock javascripts %}